<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Visualizador 3D - Altura 1.70m</title>
    <meta name="description" content="Modelos em um layout circular com altura do espectador de 1.70m">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <script>
      /*
        COMPONENTE CUSTOMIZADO: AUTOSCALE
        Este componente calcula e aplica a escala necessária para que um modelo 3D
        atinja uma altura específica em metros, mantendo sua proporção original.
      */
      AFRAME.registerComponent('autoscale', {
        schema: {
          height: {type: 'number', default: 1}
        },

        init: function () {
          this.el.addEventListener('model-loaded', this.rescale.bind(this));
        },

        rescale: function () {
          const el = this.el;
          const desiredHeight = this.data.height;
          const bbox = new THREE.Box3().setFromObject(el.object3D);
          const size = bbox.getSize(new THREE.Vector3());
          
          if (size.y === 0) return;

          const scaleFactor = desiredHeight / size.y;

          el.object3D.scale.set(scaleFactor, scaleFactor, scaleFactor);
          
          const center = bbox.getCenter(new THREE.Vector3());
          el.object3D.position.set(-center.x * scaleFactor, -bbox.min.y * scaleFactor, -center.z * scaleFactor);
        }
      });
    </script>

  </head>
  <body>
    <a-scene background="color: #ECECEC" vr-mode-ui="enterARButton: true">

      <a-assets>
        <a-asset-item id="vaso-01" src="./modelo.obj"></a-asset-item>
        <a-asset-item id="vaso-02" src="./VSPX30 - 02.obj"></a-asset-item>
        <a-asset-item id="vaso-03" src="./VSPX30 - 03.obj"></a-asset-item>
        <a-asset-item id="vaso-04" src="./VSPX30 - 04.obj"></a-asset-item>
        <a-asset-item id="vaso-05" src="./VSPX30 - 05.obj"></a-asset-item>
        <a-asset-item id="vaso-06" src="./VSPX30 - 06.obj"></a-asset-item>
      </a-assets>

      <a-plane position="0 0 0" rotation="-90 0 0" width="15" height="15" color="#CCCCCC"></a-plane>

      <a-entity position="0 0 -1.59">
        <a-entity rotation="0 0 0" obj-model="obj: #vaso-01" material="color: #E2725B" autoscale="height: 0.7"></a-entity>
      </a-entity>

      <a-entity position="1.38 0 -0.80">
        <a-entity rotation="0 -60 0" obj-model="obj: #vaso-02" material="color: #E2725B" autoscale="height: 0.7"></a-entity>
      </a-entity>

      <a-entity position="1.38 0 0.80">
        <a-entity rotation="0 -120 0" obj-model="obj: #vaso-03" material="color: #E2725B" autoscale="height: 0.7"></a-entity>
      </a-entity>

      <a-entity position="0 0 1.59">
        <a-entity rotation="0 -180 0" obj-model="obj: #vaso-04" material="color: #E2725B" autoscale="height: 0.7"></a-entity>
      </a-entity>
      
      <a-entity position="-1.38 0 0.80">
        <a-entity rotation="0 120 0" obj-model="obj: #vaso-05" material="color: #E2725B" autoscale="height: 0.7"></a-entity>
      </a-entity>

      <a-entity position="-1.38 0 -0.80">
        <a-entity rotation="0 60 0" obj-model="obj: #vaso-06" material="color: #E2725B" autoscale="height: 0.7"></a-entity>
      </a-entity>

      <a-camera position="0 1.7 0"></a-camera>

    </a-scene>
  </body>
</html><!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Visualizador 3D Interativo</title>
    <meta name="description" content="Inspecione objetos com o olhar em um layout circular">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <script>
      /*
        COMPONENTE CUSTOMIZADO: GAZE-AND-INTERACT
        - Detecta quando o usuário olha para o objeto por um tempo definido.
        - Anima o objeto para perto do espectador e o faz girar.
        - Retorna o objeto à sua posição original com um clique.
      */
      AFRAME.registerComponent('gaze-and-interact', {
        schema: {
          gazeTime: {type: 'number', default: 5000}, // Tempo em ms (5000 = 5 segundos)
          inspectPosition: {type: 'vec3', default: {x: 0, y: 1.2, z: -1.2}}, // Posição de inspeção
          inspectScale: {type: 'number', default: 1.2}, // Aumenta o tamanho em 20%
        },

        init: function () {
          this.originalPosition = new THREE.Vector3().copy(this.el.object3D.position);
          this.originalScale = new THREE.Vector3().copy(this.el.object3D.scale);
          this.modelEntity = this.el.querySelector('[obj-model]'); // Encontra a entidade do modelo
          
          this.timer = null;
          this.isInspecting = false;

          this.el.addEventListener('mouseenter', this.onMouseEnter.bind(this));
          this.el.addEventListener('mouseleave', this.onMouseLeave.bind(this));
          this.el.addEventListener('click', this.onClick.bind(this));
        },

        onMouseEnter: function () {
          if (this.isInspecting) return;
          
          this.timer = setTimeout(this.onGazeTrigger.bind(this), this.data.gazeTime);
        },

        onMouseLeave: function () {
          clearTimeout(this.timer);
          this.timer = null;
        },

        onClick: function () {
          if (!this.isInspecting) return;

          // Anima o retorno à posição original
          this.el.setAttribute('animation__position', {
            property: 'position',
            to: this.originalPosition,
            dur: 1000,
            easing: 'easeOutExpo'
          });

          // Anima o retorno à escala original
          this.el.setAttribute('animation__scale', {
            property: 'scale',
            to: this.originalScale,
            dur: 1000,
            easing: 'easeOutExpo'
          });

          // Para a animação de rotação
          this.modelEntity.removeAttribute('animation__rotation');
          
          this.isInspecting = false;
        },

        onGazeTrigger: function () {
          if (this.isInspecting) return;
          this.isInspecting = true;
          
          // Anima para a posição de inspeção
          this.el.setAttribute('animation__position', {
            property: 'position',
            to: this.data.inspectPosition,
            dur: 1500,
            easing: 'easeOutExpo'
          });

          // Anima para a escala de inspeção
          this.el.setAttribute('animation__scale', {
            property: 'scale',
            to: `${this.data.inspectScale} ${this.data.inspectScale} ${this.data.inspectScale}`,
            dur: 1500,
            easing: 'easeOutExpo'
          });

          // Inicia a animação de rotação contínua no modelo
          this.modelEntity.setAttribute('animation__rotation', {
            property: 'rotation',
            to: {x: 0, y: 360, z: 0},
            loop: true,
            dur: 10000,
            easing: 'linear'
          });
        }
      });

      // Componente autoscale que já tínhamos
      AFRAME.registerComponent('autoscale', {
        schema: { height: {type: 'number', default: 1} },
        init: function () { this.el.addEventListener('model-loaded', this.rescale.bind(this)); },
        rescale: function () {
          const el = this.el;
          const desiredHeight = this.data.height;
          const bbox = new THREE.Box3().setFromObject(el.object3D);
          const size = bbox.getSize(new THREE.Vector3());
          if (size.y === 0) return;
          const scaleFactor = desiredHeight / size.y;
          el.object3D.scale.set(scaleFactor, scaleFactor, scaleFactor);
          const center = bbox.getCenter(new THREE.Vector3());
          el.object3D.position.set(-center.x * scaleFactor, -bbox.min.y * scaleFactor, -center.z * scaleFactor);
        }
      });
    </script>
  </head>
  <body>
    <a-scene background="color: #ECECEC" vr-mode-ui="enterARButton: true">
      <a-assets>
        <a-asset-item id="vaso-01" src="./modelo.obj"></a-asset-item>
        <a-asset-item id="vaso-02" src="./VSPX30 - 02.obj"></a-asset-item>
        <a-asset-item id="vaso-03" src="./VSPX30 - 03.obj"></a-asset-item>
        <a-asset-item id="vaso-04" src="./VSPX30 - 04.obj"></a-asset-item>
        <a-asset-item id="vaso-05" src="./VSPX30 - 05.obj"></a-asset-item>
        <a-asset-item id="vaso-06" src="./VSPX30 - 06.obj"></a-asset-item>
      </a-assets>

      <a-plane position="0 0 0" rotation="-90 0 0" width="15" height="15" color="#CCCCCC"></a-plane>

      <a-entity position="-2.5 0 -3" gaze-and-interact><a-entity obj-model="obj: #vaso-01" material="color: #E2725B" autoscale="height: 0.7" rotation="0 90 0"></a-entity></a-entity>
      <a-entity position="-1.5 0 -3" gaze-and-interact><a-entity obj-model="obj: #vaso-02" material="color: #E2725B" autoscale="height: 0.7" rotation="0 54 0"></a-entity></a-entity>
      <a-entity position="-0.5 0 -3" gaze-and-interact><a-entity obj-model="obj: #vaso-03" material="color: #E2725B" autoscale="height: 0.7" rotation="0 18 0"></a-entity></a-entity>
      <a-entity position="0.5 0 -3" gaze-and-interact><a-entity obj-model="obj: #vaso-04" material="color: #E2725B" autoscale="height: 0.7" rotation="0 -18 0"></a-entity></a-entity>
      <a-entity position="1.5 0 -3" gaze-and-interact><a-entity obj-model="obj: #vaso-05" material="color: #E2725B" autoscale="height: 0.7" rotation="0 -54 0"></a-entity></a-entity>
      <a-entity position="2.5 0 -3" gaze-and-interact><a-entity obj-model="obj: #vaso-06" material="color: #E2725B" autoscale="height: 0.7" rotation="0 -90 0"></a-entity></a-entity>

      <a-camera position="0 1.7 0">
        <a-cursor></a-cursor>
      </a-camera>

    </a-scene>
  </body>
</html>